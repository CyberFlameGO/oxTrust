<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:f="http://xmlns.jcp.org/jsf/core"
	xmlns:b="http://bootsfaces.net/ui"
	xmlns:h="http://xmlns.jcp.org/jsf/html"
	xmlns:p="http://xmlns.jcp.org/jsf/passthrough"
	xmlns:ox="http://xmlns.jcp.org/jsf/composite/ox"
	xmlns:rich="http://richfaces.org/rich"
	xmlns:a4j="http://richfaces.org/a4j"
	xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
	template="/WEB-INF/incl/layout/newtemplate.xhtml">

	<f:metadata>
		<f:viewAction action="#{conversationService.initConversation}" />
		<f:viewAction action="#{manageCustomScriptAction.initAcrs}"
			onPostback="false" />
		<f:viewAction action="#{manageCustomScriptAction.init(true)}"
			onPostback="false" />
	</f:metadata>
	<ui:define name="head">
	</ui:define>
	<ui:define name="body">
		<section class="content-header">
			<h1 style="color: #333;">
				#{msg['customScript.configuration']} <small> <i
					class="fa fa-caret-right" style="color: #333 !important;" />#{msg['customScript.manageCustomScripts']}
				</small>
			</h1>
			<ol class="breadcrumb">
				<li><a href="#{request.contextPath}/home.htm"> <i
						class="fa fa-home" />
				</a></li>
				<li class="organization/configuration">#{msg['customScript.manageCustomScripts']}</li>
			</ol>
		</section>
		<h:outputStylesheet>
		.list-group-item{
		background-color: #05ffb0;
		}
	    .button:hover{
		 background-image: none !important;
		 background-color: #f39c12 !important;
		}
		</h:outputStylesheet>
		<section class="content">
			<b:panel id="main" title="Gluu Custom Scripts" look="primary"
				iconAwesome="fa-tree" collapsible="false">
				<h:form prependId="false">
					<div class="row">
						<div class="col-sm-3 col-md-3 col-lg-3">
							<b:tree render-root="false" id="customScriptTreeViewId"
								collapse-icon="fa fa-angle-down" selected-color="#ffffff"
								nodeSelectionListener="#{manageCustomScriptAction}"
								expand-icon="fa fa-angle-right" update="@form"
								value="#{manageCustomScriptAction.getTree()}" showBorder="true"
								style="width:100%;overflow-x:scroll" />
						</div>
						<div class="col-sm-9 col-md-9 col-lg-9">
							<b:row>
								<b:column medium-screen="8">
									<b:breadcrumbs>
										<f:facet name="root">
											<b:iconAwesome value="fa-desktop" /> Custom scripts
                                    </f:facet>
										<b:navLink
											value="#{manageCustomScriptAction.selectedScriptType.getDisplayName() eq null ? manageCustomScriptAction.selectedScript.getScriptType().getDisplayName() : manageCustomScriptAction.selectedScriptType.getDisplayName()}"
											outcome="#" />
										<b:navLink
											value="#{manageCustomScriptAction.selectedScript.getName()}"
											outcome="#" icon-awesome="pencil-square-o" />
									</b:breadcrumbs>
								</b:column>
								<b:column medium-screen="4">
									<b:commandButton
										action="#{manageCustomScriptAction.initAddForm()}"
										rendered="#{manageCustomScriptAction.showAddButton}"
										look="warning" styleClass="AddCustomScriptButton"
										value="Add New Custom Script" ajax="true" update="@form"
										icon="plus"
										style="margin-bottom:5px !important; float: right;" />
								</b:column>
							</b:row>
							<b:panel id="customScriptDetailPanelId"
								title="#{manageCustomScriptAction.selectedScript.name}"
								look="primary" icon="pencil" collapsible="false">
								<b:messages />
								<h:panelGroup layout="block">
									<ui:param name="_customScript"
										value="#{manageCustomScriptAction.selectedScript}" />
									<div class="row">
										<div class="col-sm-5 col-md-5 col-lg-5"></div>
										<div class="col-sm-2 col-md-2 col-lg-2">
											<a4j:commandLink value="Show Error" immediate="true"
												rendered="#{manageCustomScriptAction.hasCustomScriptError(_customScript)}"
												onclick="#{rich:component('viewScriptError:viewFile')}.show();"
												execute="@region"
												styleClass="btn btn-warning showErrorButton"
												style="color:white;" />
										</div>
										<div class="col-sm-3 col-md-3 col-lg-3">
											<h:commandButton onclick="window.location.reload(true);"
												style="margin-right:5px;"
												styleClass="btn btn-primary cancelScriptButton"
												value="Cancel" />
											<h:commandButton
												action="#{manageCustomScriptAction.saveScript()}"
												styleClass="btn btn-primary saveScriptButton" value="Save" />
										</div>
										<div class="col-sm-2 col-md-2 col-lg-2">
											<a4j:commandLink value="Delete Script" immediate="true"
												onclick="#{rich:component('deleteConfirmation:acceptRemovalModalPanel')}.show();"
												execute="@region" style="color:white;margin-right:30px;"
												styleClass="btn btn-danger deleteScriptButton" />
										</div>
									</div>
									<h:panelGroup layout="block">
										<ox:decorate label="#{msg['customScript.name']}"
											forId="#{msg['customScript.name']}" leftClass="col-sm-3"
											rightClass="col-sm-9">
											<h:inputText value="#{_customScript.name}" size="90"
												required="#{empty param['rq']}" p:autofocus="true"
												validatorMessage="#{msg['customScript.name.error']}"
												styleClass="form-control scriptNameTextBox"
												style="width:100%;">
												<f:validateRegex pattern="^[a-zA-Z0-9_\\-\\:\\/\\.]+$" />
											</h:inputText>
										</ox:decorate>
										<ox:decorate label="#{msg['customScript.description']}"
											required="true" styleClass="break-word"
											forId="#{msg['customScript.description']}"
											leftClass="col-sm-3" rightClass="col-sm-9">
											<h:inputText value="#{_customScript.description}" size="90"
												styleClass="form-control descriptionTextBox"
												style="width: 100%;">
											</h:inputText>
										</ox:decorate>
										<ox:decorate label="SAML ACRS" leftClass="col-sm-3"
											rendered="#{manageCustomScriptAction.isPersonScript(_customScript)}"
											rightClass="col-sm-9">
											<h:selectManyListbox styleClass="samlAcrs"
												value="#{_customScript.aliases}" id="SamlACRSId">
												<f:selectItems
													value="#{manageCustomScriptAction.getAvailableAcrs(_customScript.name)}" />
											</h:selectManyListbox>
											<b:commandButton
												action="#{manageCustomScriptAction.resetAcrs(_customScript)}"
												look="success" styleClass="clearAcrlButton"
												style="float:right;" iconAwesome="fa-refresh" value=""
												ajax="true" update="@parent" />
										</ox:decorate>
										<div class="row">
											<div class="col-sm-7 col-md-7 col-lg-7">
												<ox:decorate
													label="#{msg['customScript.programmingLanguage']}"
													required="true" styleClass="break-word"
													leftClass="col-sm-6" rightClass="col-sm-6"
													forId="#{msg['customScript.description']}" oneColumn="true">
													<h:selectOneMenu
														value="#{_customScript.programmingLanguage}"
														required="true" disabled="true" styleClass="form-control">
														<f:selectItems
															value="#{configurationService.programmingLanguages}"
															var="_type" itemLabel="#{_type.displayName}" />
													</h:selectOneMenu>
												</ox:decorate>
											</div>
											<div class="col-sm-5 col-md-5 col-lg-5">
												<ox:decorate label="#{msg['customScript.locationType']}"
													styleClass="break-word"
													forId="#{msg['customScript.locationType']}"
													leftClass="col-sm-6" rightClass="col-sm-6" oneColumn="true">
													<h:selectOneMenu value="#{_customScript.locationType}"
														required="false"
														styleClass="form-control locationTypeSelectBox">
														<f:selectItems
															value="#{configurationService.locationTypes}" var="_type"
															itemLabel="#{_type.displayName}" />
														<a4j:ajax event="change"
															render="scriptAreaId, scriptPathId" limitRender="true"
															execute="@this">
														</a4j:ajax>
													</h:selectOneMenu>
												</ox:decorate>
											</div>
										</div>
										<div class="row">
											<div class="col-sm-7 col-md-7 col-lg-7">
												<ox:decorate
													label="#{(_scriptType.value != 'uma_claims_gathering')   ? msg['customScript.level']  : msg['customScript.priority']}"
													required="true" styleClass="break-word"
													forId="#{msg['customScript.description']}"
													leftClass="col-sm-6" rightClass="col-sm-6">
													<b:touchSpin id="serverPortID" required="true"
														styleClass="rounded inputNumberSpinnerBox"
														value="#{_customScript.level}" min="0" max="100" step="1" />
												</ox:decorate>
											</div>
											<div class="col-sm-5 col-md-5 col-lg-5">
												<ox:decorate label="#{msg['customScript.enabled']}"
													forId="#{msg['customScript.enabled']}" leftClass="col-sm-6"
													rightClass="col-sm-6">
													<h:selectBooleanCheckbox value="#{_customScript.enabled}"
														styleClass="customScriptStatusCheckBox" />
												</ox:decorate>
											</div>
										</div>
										<h:panelGroup layout="block" styleClass="right"
											rendered="#{_scriptType.value eq 'person_authentication'}">
											<ox:decorate label="#{_customScript.usageType}"
												required="true" forId="#{_customScript.usageType}"
												oneColumn="true">
												<h:selectOneMenu value="#{_customScript.usageType}"
													required="true"
													styleClass="form-control usageTypeSelectBox">
													<f:selectItems
														value="#{configurationService.scriptUsageTypes}"
														var="_usageType" itemLabel="#{_usageType.displayName}" />
												</h:selectOneMenu>
											</ox:decorate>
										</h:panelGroup>
										<b:panel title="Custom Properties" look="primary"
											iconAwesome="fa-cogs" style="margin-left:20px !important;">
											<ox:simpleCustomPropertiesList
												label="#{msg['manageAuthentication.passport.strategy.addProperty']}"
												hideLabel="true" showRemoveDialogue="true"
												properties="#{_customScript.configurationProperties}"
												propertiesAction="#{manageCustomScriptAction}"
												hideValue="true" />
										</b:panel>
										<b:panel id="scriptAreaId" title="Script content"
											look="primary" iconAwesome="fa-random"
											style="margin-left:20px !important;padding:0px !important;">
											<h:inputTextarea
												rendered="#{_customScript.locationType.value ne 'file'}"
												value="#{_customScript.script}" style="width: 100%;"
												styleClass="form-control scriptTextArea" cols="110"
												rows="10" />
										</b:panel>
										<h:panelGroup id="scriptPathId">
											<h:panelGroup layout="block" styleClass="form-group"
												rendered="#{_customScript.locationType.value eq 'file'}">
												<ox:decorate label="#{msg['customScript.scriptPath']}"
													forId="#{msg['customScript.scriptPath']}"
													tooltip="#{msg['customScript.scriptPath']}"
													rendered="#{_customScript.locationType.value eq 'file'}">
													<h:inputText value="#{_customScript.locationPath}"
														size="90" styleClass="form-control scriptPathTextBox" />
												</ox:decorate>
											</h:panelGroup>
										</h:panelGroup>
										<hr></hr>
										<ox:acceptRemovalDialog id="deleteConfirmation"
											subject="Script" value="#{_customScript.name}"
											deleteMethod="#{manageCustomScriptAction.removeCustomScript}"
											render="main" />
										<ox:viewFileDialog id="viewScriptError" label="Error"
											text="#{manageCustomScriptAction.getCustomScriptError(_customScript)}"
											textHeight="370" textWidth="680" />
									</h:panelGroup>
								</h:panelGroup>
							</b:panel>
						</div>
					</div>
				</h:form>
			</b:panel>
		</section>
	</ui:define>
</ui:composition>