<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:a4j="http://richfaces.org/a4j"
	xmlns:f="http://xmlns.jcp.org/jsf/core"
	xmlns:h="http://xmlns.jcp.org/jsf/html"
	xmlns:b="http://bootsfaces.net/ui"
	xmlns:ox="http://xmlns.jcp.org/jsf/composite/ox"
	xmlns:rich="http://richfaces.org/rich"
	xmlns:richext="http://xmlns.jcp.org/jsf/composite/richext"
	xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
	template="/WEB-INF/incl/layout/newtemplate.xhtml">
	<f:metadata>
		<f:viewAction
			action="#{permissionService.requestPermission('uma', 'access')}" />
		<f:viewAction action="#{conversationService.initConversation}" />
		<f:viewAction action="#{passportIdpInitiatedAction.init}"
			onPostback="false" />
	</f:metadata>

	<ui:define name="body">

		<section class="content-header">
			<h1 style="color: #333;">
				#{msg['passport.title']} <small> <i
					class="fa fa-caret-right" style="color: #333 !important;" />#{msg['passport.idpInitiated']}
				</small>
			</h1>
			<ol class="breadcrumb">
				<li><a href="#{request.contextPath}/home"> <i
						class="fa fa-home" />
				</a></li>
				<li class="organization/configuration"><a
					href="#{request.contextPath}/passport/idpInitiatedFlows">#{msg['passport.idpInitiated']}</a></li>
			</ol>
		</section>
		<section class="content">
			<div class="row">
				<div class="col-xs-12">
					<div class="box box-primary">
						<h:form id="IdpInitiatedForm">
							<input type='hidden' name='cid' value='#{conversation.id}' />
							<div class="row"
								style="margin-left: 10px; margin-right: 10px; margin-top: 10px;">
								<h:panelGroup columns="1" width="100%" id="openIDConnectSection">
									<b:panel title="#{msg['passport.idpinitiated.oidc.title']}"
										look="primary">
										<div class="row">
											<!-- First column-->
											<div class="col-sm-6 col-lg-6" style="padding: 0px;">
												<ox:decorate
													label="#{msg['passport.idpinitiated.oidc.passport.authorizationEndpoint']}"
													leftClass="col-sm-3" rightClass="col-sm-9">
													<h:inputText
														styleClass="form-control AuthorizationEndPointID"
														style="width:100%" required="true"
														value="#{passportIdpInitiatedAction.iiConfiguration.openidclient.authorizationEndpoint}"
														id="AuthorizationEndPointID" rendered="true">
														<rich:validator event="blur" />
													</h:inputText>
												</ox:decorate>
												<ox:decorate
													label="#{msg['passport.idpinitiated.oidc.passport.acrValues']}"
													leftClass="col-sm-3" rightClass="col-sm-9"
													id="PostProfileEndpointID">
													<h:outputText styleClass="form-control AcrValuesID"
														style="width:100%" required="true"
														value="#{passportIdpInitiatedAction.iiConfiguration.openidclient.acrValues}"
														id="AcrValuesID">
													</h:outputText>
												</ox:decorate>
											</div>
											<!-- Second column-->
											<div class="col-sm-6 col-lg-6" style="padding: 0px;">
												<b:form horizontal="true">
													<b:formGroup>
														<b:selectOneMenu id="ClientID"
															value="#{passportIdpInitiatedAction.iiConfiguration.openidclient.clientId}"
															select2="true" colMd="9" required="true" labelColMd="3"
															label="#{msg['passport.idpinitiated.oidc.passport.clientId']}">
															<f:selectItem itemLabel="(Please select a client)"
																itemValue="" />
															<f:selectItems
																value="#{passportIdpInitiatedAction.clients}"
																var="client" itemValue="#{client.inum}"
																itemLabel="#{client.displayName}" />
														</b:selectOneMenu>
													</b:formGroup>
												</b:form>
											</div>
										</div>
									</b:panel>
									<b:panel id="AuthParametersListID"
										rendered="#{(passportIdpInitiatedAction.authzParams.size() ne 0) and !passportIdpInitiatedAction.showForm}"
										title="#{msg['passport.idpinitiated.authParams.title']}"
										look="primary">
										<h:panelGroup columns="1" width="100%" id="AuthParamsSection">
											<!-- AuthorizationParams List section-->
											<div class="row" style="margin-left: 5px; margin-right: 5px;">
												<a4j:commandButton styleClass="btn btn-primary addNewParam"
													value="Add New AuthZParam"
													action="#{passportIdpInitiatedAction.activateForm}"
													render="IdpInitiatedForm,AuthZParamFormId,AuthParametersListID"
													execute="@this" />
											</div>
											<b:dataTable id="paramsTableId"
												value="#{passportIdpInitiatedAction.authzParams}" var="c"
												print="true" excel="true" csv="true" pdf="true"
												select="true">
												<b:dataTableColumn
													label="#{msg['passport.idpinitiated.authParams.provider']}">
													<h:link includeViewParams="false"
														outcome="/passport/editProvider" value="#{c.provider}">
														<f:param name="id" value="#{c.provider}" />
													</h:link>
												</b:dataTableColumn>
												<b:dataTableColumn value="#{c.responseType}"
													label="#{msg['passport.idpinitiated.authParams.responseType']}" />
												<b:dataTableColumn value="#{c.scopes}"
													label="#{msg['passport.idpinitiated.authParams.scope']}" />
												<b:dataTableColumn value="#{c.redirectUri}" order="asc"
													label="#{msg['passport.idpinitiated.authParams.redirectUri']}" />
												<b:dataTableColumn label="Actions">
													<a4j:commandButton
														styleClass="btn btn-primary cancelAuthParamId"
														value="Edit" style="margin-left: 5px;"
														action="#{passportIdpInitiatedAction.editAuthParam(c)}"
														render="IdpInitiatedForm,AuthZParamFormId" execute="@this" />
													<a4j:commandButton
														styleClass="btn btn-primary deleteParamId" value="Remove"
														style="margin-left: 5px;"
														action="#{passportIdpInitiatedAction.removeAuthParam(c)}"
														render="IdpInitiatedForm" execute="@this" />
												</b:dataTableColumn>
											</b:dataTable>
										</h:panelGroup>
									</b:panel>
								</h:panelGroup>
								<h:panelGroup rendered="#{!passportIdpInitiatedAction.showForm}">
									<div id="updateButtons"
										style="margin-left: 15px; margin-bottom: 10px;">
										<h:commandButton action="#{passportIdpInitiatedAction.save}"
											style="margin-left:5px;" styleClass="btn btn-primary"
											value="save" />
										<h:commandButton action="#{passportIdpInitiatedAction.cancel}"
											immediate="true" style="margin-left:5px;"
											styleClass="btn btn-primary" value="#{msg['client.cancel']}" />
									</div>
								</h:panelGroup>
							</div>
						</h:form>
						<h:form id="AuthZParamFormId">
							<div class="row"
								style="margin-left: 10px; margin-right: 10px; margin-top: 10px;">
								<b:panel title="AuthZ Parameter Form"
									rendered="#{passportIdpInitiatedAction.showForm}"
									look="success">
									<h:panelGroup id="ParamFormID"
										rendered="#{passportIdpInitiatedAction.showForm}">
										<div class="row">
											<!-- First column-->
											<div class="col-sm-6 col-lg-6" style="padding: 0px;">
												<b:form horizontal="true">
													<b:formGroup>
														<b:selectOneMenu id="ProviderID"
															value="#{passportIdpInitiatedAction.authzParam.provider}"
															select2="true" colMd="9" required="true" labelColMd="3"
															label="#{msg['passport.idpinitiated.authParams.provider']}">
															<f:selectItem itemLabel="Please select a provider"
																itemValue="" />
															<f:selectItems
																value="#{passportIdpInitiatedAction.providers}"
																var="provider" itemValue="#{provider.id}"
																itemLabel="#{provider.displayName}" />
														</b:selectOneMenu>
													</b:formGroup>
													<b:formGroup>
														<b:inputText id="RedirectURI" colMd="9" labelColMd="3"
															value="#{passportIdpInitiatedAction.authzParam.redirectUri}"
															styleClass="rounded form-control RedirectURI"
															label="#{msg['passport.idpinitiated.authParams.redirectUri']}" />
													</b:formGroup>
												</b:form>
											</div>
											<!-- Second column-->
											<div class="col-sm-6 col-lg-6" style="padding: 0px;">
												<b:form horizontal="true" id="hForm">
													<b:formGroup>
														<b:inputText tags="true" id="ResponseTypesID"
															label="#{msg['passport.idpinitiated.authParams.responseType']}"
															required="true" colMd="9" labelColMd="3"
															style-class="tags"
															value="#{passportIdpInitiatedAction.authzParam.responseType}"
															placeholder="Select responses types" typeahead="true"
															typeahead-values="#{passportIdpInitiatedAction.responseTypes}" />
													</b:formGroup>
													<b:formGroup>
														<b:inputText tags="true" id="ScopesID"
															label="#{msg['passport.idpinitiated.authParams.scope']}"
															required="true" colMd="9" labelColMd="3"
															style-class="tags"
															value="#{passportIdpInitiatedAction.authzParam.scopes}"
															placeholder="Select scopes" typeahead="true"
															typeahead-values="#{passportIdpInitiatedAction.scopes}" />
													</b:formGroup>
												</b:form>
											</div>
										</div>
										<!-- Form footer-->
										<div class="row"
											style="margin-left: 50px; margin-right: 5px; margin-bottom: 20px;">
											<div id="updateButtons">
												<a4j:commandButton
													styleClass="btn btn-primary saveAuthParamId"
													onclick="submit();" value="#{msg['client.add']}"
													style="margin-left: 5px;"
													action="#{passportIdpInitiatedAction.addAuthParam}"
													render="AuthZParamFormId" execute="@this" />
												<a4j:commandButton
													styleClass="btn btn-primary cancelAuthParamId"
													value="#{msg['client.cancel']}" style="margin-left: 5px;"
													action="#{passportIdpInitiatedAction.cancelParamAdd}"
													render="AuthZParamFormId,IdpInitiatedForm" execute="@this" />
											</div>
										</div>
									</h:panelGroup>
								</b:panel>
							</div>
						</h:form>
					</div>
				</div>
			</div>
			<script>
				$('.tags').tagsinput('refresh');
			</script>
		</section>
	</ui:define>
</ui:composition>
